/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/utils.py:429: FutureWarning: Importing read_csv from `anndata` is deprecated. Import anndata.io.read_csv instead.
  warnings.warn(msg, FutureWarning)
/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/utils.py:429: FutureWarning: Importing read_text from `anndata` is deprecated. Import anndata.io.read_text instead.
  warnings.warn(msg, FutureWarning)
/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/utils.py:429: FutureWarning: Importing read_excel from `anndata` is deprecated. Import anndata.io.read_excel instead.
  warnings.warn(msg, FutureWarning)
/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/utils.py:429: FutureWarning: Importing read_mtx from `anndata` is deprecated. Import anndata.io.read_mtx instead.
  warnings.warn(msg, FutureWarning)
/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/utils.py:429: FutureWarning: Importing read_loom from `anndata` is deprecated. Import anndata.io.read_loom instead.
  warnings.warn(msg, FutureWarning)
/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/utils.py:429: FutureWarning: Importing read_hdf from `anndata` is deprecated. Import anndata.io.read_hdf instead.
  warnings.warn(msg, FutureWarning)
/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/utils.py:429: FutureWarning: Importing read_umi_tools from `anndata` is deprecated. Import anndata.io.read_umi_tools instead.
  warnings.warn(msg, FutureWarning)
/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_core/anndata.py:1756: UserWarning: Observation names are not unique. To make them unique, call `.obs_names_make_unique`.
  utils.warn_names_duplicates("obs")
Loading /home/rajd2/rds/rds-cam-psych-transc-Pb9UGUlrwWc/Cam_snRNAseq/combined/combined_postnatal_full_harmony_10k.h5ad...
Total cells: 10000
Dataset counts:
dataset
HBCC       4190
Aging      3506
U01         833
Herring     739
Wang        722
Ramos        10
Name: count, dtype: int64

--- Running get_original_metadata ---
Extracting original metadata...
Loading metadata from sources: ['HBCC' 'AGING' 'VELMESHEV' 'WANG']
Processing VELMESHEV (1582 cells)...
Error processing Velmeshev: "['cell_subclass'] not in index"
Processing WANG (722 cells)...
Processing HBCC (4190 cells)...
Traceback (most recent call last):
  File "/home/rajd2/rds/hpc-work/snRNAseq_2026/scripts/check_test_alignment.py", line 23, in <module>
    meta = get_original_metadata(obs, base_dir)
  File "/home/rajd2/rds/hpc-work/snRNAseq_2026/code/metadata_utils.py", line 194, in get_original_metadata
    ad = sc.read_h5ad(path, backed='r')
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/h5ad.py", line 214, in read_h5ad
    return read_h5ad_backed(filename, mode)
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/h5ad.py", line 157, in read_h5ad_backed
    d.update({k: read_elem(f[k]) for k in attributes if k in f})
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/h5ad.py", line 157, in <dictcomp>
    d.update({k: read_elem(f[k]) for k in attributes if k in f})
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/specs/registry.py", line 377, in read_elem
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/utils.py", line 213, in func_wrapper
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/specs/registry.py", line 280, in read_elem
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/specs/methods.py", line 884, in read_dataframe
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/specs/methods.py", line 884, in <dictcomp>
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/utils.py", line 213, in func_wrapper
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/specs/registry.py", line 280, in read_elem
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/specs/methods.py", line 994, in read_categorical
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/utils.py", line 213, in func_wrapper
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/specs/registry.py", line 280, in read_elem
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/anndata/_io/specs/methods.py", line 448, in read_array
  File "h5py/_objects.pyx", line 54, in h5py._objects.with_phil.wrapper
  File "h5py/_objects.pyx", line 55, in h5py._objects.with_phil.wrapper
  File "/opt/micromamba/envs/shortcake_default/lib/python3.10/site-packages/h5py/_hl/dataset.py", line 781, in __getitem__
KeyboardInterrupt
